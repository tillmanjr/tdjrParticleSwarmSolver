<!DOCTYPE HTML PUBLIC
     "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Graph 3D demo</title>

    <style>
      body {font: 10pt arial;}
    </style>

    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript" src="./libs/graph3d.js"></script>
    <script type="text/javascript" src="./bundles/bundle.js"></script>

  </head>

  <body>
    <div id="swarmGraph"></div>
    <div id="doubleDipPlotGraph"></div>
    <script type="text/javascript">
      var swarmPlotData = null;
      var swarmGraph = null;

      var doubleDipPlotData = null;
      var doubleDipPlotGraph = null;

      google.load("visualization", "1");

      // Set callback to run when API is loaded
      google.setOnLoadCallback(drawVisualization);

      function compareXYZ( lhs, rhs) {
        if (lhs.x > rhs.x) 
          return 1
        if (lhs.x < rhs.x) 
          return -1
        // the two x coordinates are equal so compare y coordingas
        if (lhs.y > rhs.y) 
          return 1
        if (lhs.y < rhs.y) 
          return -1
        return 0
      }

      // Called when the Visualization API is loaded.
      function drawVisualization() {
        // Create and populate a data table.
        swarmPlotData = new google.visualization.DataTable();
        swarmPlotData.addColumn('number', 'x');
        swarmPlotData.addColumn('number', 'y');
        swarmPlotData.addColumn('number', 'z');

        doubleDipPlotData = new google.visualization.DataTable();
        doubleDipPlotData.addColumn('number', 'x');
        doubleDipPlotData.addColumn('number', 'y');
        doubleDipPlotData.addColumn('number', 'z');

        
      if ( window['Swarming']) { 

        var doubleDipData = window['Swarming'].getDoubleDipPlotData()
        for (var i = 0, len = doubleDipData.length; i < len; i++ ) {
          var datum = doubleDipData[i]
          var px = datum.x
          var py = datum.y
          var pz = datum.z * 1000.0
          doubleDipPlotData.addRow([px, py, pz])
        }

        var swarmResult = window['Swarming'].getTestData()
        const xMult = 1.0 //2
        const yMult = 1.0 //2
        const zMult = 1000.0
        var swarmData = swarmResult.data.map(function (item) {
          return {
            x: Math.ceil(item.x * xMult),
            y: Math.ceil(item.y * yMult),
            z: item.z * zMult,
          }
        })

        //swarmData.sort(compareXYZ)
        for (var i = 0, len = swarmData.length; i < len; i++ ) {
          var datum = swarmData[i]
          var sx = datum.x 
          var sy = datum.y
          var sz = datum.z
          swarmPlotData.addRow([sx, sy, sz])
        }
      }

        for (var j = 0, len = swarmPlotData.Nf.length; j < len; j++) {
          var item = swarmPlotData.Nf[j].c
          console.log(`x: ${item[0].v}\ty: ${item[1].v}\tz: ${item[2].v}`)
        }

        // specify options
        options = {width:  "800px",
                   height: "800px",
                   style: "surface",
                   showXAxis: false,
                   showYAxis: false,
                   showZAxis: false,
                   showPerspective: false,
                   showGrid: true,
                   showShadow: true,
                   showLegend: true,
                   keepAspectRatio: false,
                   verticalRatio: 1.0,
                   tooltip: function (point) {
                    // parameter point contains properties x, y, z
                    const zVal= point.z != 0.0 ? point.z.toFixed(18) / 1000.0 : 0.0
                    return `fn(${point.x.toFixed(18)}, ${point.y.toFixed(18)}) = <b>` + zVal + '</b>';
                  }
                   };

        // Instantiate our graph object.
        swarmGraph = new links.Graph3d(document.getElementById('swarmGraph'));
        // Draw our graph with the created data and options
        swarmGraph.draw(swarmPlotData, options);

        dblDipOptions = {
                  width:  "800px",
                   height: "800px",
                   style: "surface",
                   showXAxis: false,
                   showYAxis: false,
                   showZAxis: false,
                   showPerspective: false,
                   showGrid: true,
                   showShadow: true,
                   showLegend: true,
                   keepAspectRatio: false,
                   verticalRatio: 1.0,
                   tooltip: function (point) {
                    // parameter point contains properties x, y, z
                    const zVal= point.z != 0.0 ? point.z.toFixed(18) / 1000.0 : 0.0
                    return `fn(${point.x.toFixed(2)}, ${point.y.toFixed(2)}) = <b>` + zVal + '</b>';
                  }
        };
        doubleDipPlotGraph = new links.Graph3d(document.getElementById('doubleDipPlotGraph'));
        doubleDipPlotGraph.draw(doubleDipPlotData, dblDipOptions)
      }

      </script>
  </body>
</html>